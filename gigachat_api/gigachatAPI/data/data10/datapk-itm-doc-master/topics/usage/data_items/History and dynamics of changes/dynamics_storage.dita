<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="dynamics_storage">
    <title>Хранение динамики изменений</title>
    <body>
        <p>Динамика изменений является встроенным механизмом обработки данных истории, где для
            каждого часа хранятся значения минимума, максимума и усредненное значение, а также общее
            количество значений за этот час.</p>
        <p>Можно указать, сколько дней динамика изменений будет храниться:</p>
        <ul id="ul_ipq_l15_frb">
            <li>в диалоге свойств элемента данных;</li>
            <li>при массовом обновлении элементов данных;</li>
            <li>при настройке задач очистки истории.</li>
        </ul>
        <p>Обычно динамика изменений может храниться намного дольше, чем история. Любые более старые
            данные будут удалены с помощью автоматической очистки базы данных (Housekeeper).</p>
        <p>DATAPK ITM-K сервер аккумулирует данные динамики изменений в реальном времени в кэше
            динамики изменений по мере поступления потока данных. Сервер сбрасывает динамику
            изменений в базу данных (где веб-интерфейс может найти их) в следующих ситуациях:</p>
        <ul id="ul_jpq_l15_frb">
            <li>начался новый час, и сервер получил новое значение по этому элементу данных;</li>
            <li>новый час начнется менее, чем за 5 минут до конца предыдущего (новые значения
                отсутствуют);</li>
            <li>сервер останавливается.</li>
        </ul>
        <p>Для просмотра динамики изменений на графике нужно ожидать по крайней мере до начала
            следующего часа (если элемент данных обновляется часто) и почти до конца следующего часа
            (если элемент данных обновляется реже), что означает максимум 2 часа.</p>
        <p>Когда сервер сбрасывает кэш динамики изменений и в базе данных уже имеются данные
            динамики изменений за этот час (например, сервер был перезапущен в середине часа),
            серверу потребуется использовать запросы обновления вместо простых запросов вставки.
            Поэтому на больших инсталляциях, если требуется перезапуск, лучше всего останавливать
            сервер в конце одного часа и запускать его в начале следующего часа, чтобы избежать
            наложения данных динамики изменения.</p>
        <p>Таблицы истории никак не участвуют в генерации динамики изменений.</p>
        <p>Если динамика изменений установлена в '0', сервер DATAPK ITM-K вообще не будет считать и
            хранить динамику изменений.</p>
        <p>Динамика изменений вычисляется и сохраняется с использованием того же типа данных, как и
            оригинальные значения. В результате среднее значение вычисления значений целочисленных
            типов данных округляется, и чем меньше интервал значений, тем меньше будет точность
            результата. Например, если элемент данных имеет значения 0 и 1, средним значением будет
            0, а не 0.5.</p>
        <p>Перезапуск сервера также может привести к потере точности вычисления усредненных значений
            у целочисленных типов данных за текущий час.</p>
    </body>
</topic>
